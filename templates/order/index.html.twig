{# Historique des commandes : liste toutes les commandes passées par l'utilisateur #}
{% extends 'base.html.twig' %}

{% block title %}Mes Commandes - Auxilia E-commerce
{% endblock %}

{% block body %}
	<div class="py-5">
		<div class="d-flex justify-content-between align-items-end mb-5">
			<div>
				<h1 class="display-4 fw-bold text-primary mb-2">Mes Commandes</h1>
				<p class="text-muted lead mb-0">Historique de vos achats à La Coopé</p>
			</div>
			<a href="{{ path('app_profile') }}" class="btn btn-outline-secondary rounded-pill fw-bold">
				<i class="fas fa-user me-2"></i>Mon Profil
			</a>
		</div>

		{% if orders|length > 0 %}
			<div class="card border-0 shadow-sm rounded-4 overflow-hidden">
				<div class="card-header bg-white py-3 px-4 border-bottom">
					<h2 class="h5 fw-bold mb-0">Toutes vos commandes ({{ orders|length }})</h2>
				</div>

				<div class="card-body p-0">
					<div class="list-group list-group-flush">
						{% for order in orders %}
							<div class="list-group-item p-4 p-md-5 hover-bg-light transition-all">
								<div class="row align-items-start g-4">
									<div class="col-lg-8">
										<div class="d-flex align-items-center gap-3 mb-4">
											<h3 class="h4 fw-bold mb-0">Commande #{{ order.id }}</h3>
											<span class="badge rounded-pill px-3 py-2
																																																																{% if order.status == 'pending' %}bg-warning text-dark
																																																																{% elseif order.status == 'confirmed' %}bg-info text-white
																																																																{% elseif order.status in ['shipped', 'delivered'] %}bg-success text-white
																																																																{% elseif order.status == 'cancelled' %}bg-danger text-white
																																																																{% else %}bg-secondary text-white{% endif %}">
												{% if order.status == 'pending' %}En attente
													{% elseif order.status == 'confirmed' %}Confirmée
													{% elseif order.status == 'shipped' %}Expédiée
													{% elseif order.status == 'delivered' %}Livrée
													{% elseif order.status == 'cancelled' %}Annulée
												{% else %}
													{{ order.status|upper }}
												{% endif %}
											</span>
										</div>

										<div class="row g-4 text-center text-md-start mb-4">
											<div class="col-md-4">
												<div class="small text-muted text-uppercase fw-bold mb-1">Date</div>
												<div class="fw-bold">{{ order.dateat|date('d/m/Y à H:i') }}</div>
											</div>
											<div class="col-md-4">
												<div class="small text-muted text-uppercase fw-bold mb-1">Total</div>
												<div class="h4 fw-bold text-primary mb-0">{{ order.total }}
													€</div>
											</div>
										</div>

										{% if order.orderItems|length > 0 %}
											<div class="bg-light rounded-3 p-3 mt-3">
												<h4 class="small text-uppercase fw-bold text-muted mb-3 border-bottom pb-2">Détails des articles</h4>
												<ul class="list-unstyled mb-0">
													{% for item in order.orderItems %}
														<li class="d-flex justify-content-between align-items-center small mb-2">
															<span class="text-dark fw-medium">{{ item.quantity }}x
																{{ item.productName }}</span>
															<span class="fw-bold text-muted">{{ item.price }}
																€</span>
														</li>
													{% endfor %}
												</ul>
											</div>
										{% endif %}
									</div>

									<div class="col-lg-4 text-center text-lg-end">
										<div class="d-grid gap-2">
											<a href="{{ path('app_order_show', {id: order.id}) }}" class="btn btn-primary rounded-pill fw-bold">
												<i class="fas fa-eye me-2"></i>Détails commande
											</a>
											{% if order.status in ['paid', 'shipped', 'delivered'] %}
												<a href="{{ path('app_order_tracking', {id: order.id}) }}" class="btn btn-outline-secondary rounded-pill">
													<i class="fas fa-truck me-2"></i>Suivi colis
												</a>
											{% endif %}
										</div>
									</div>
								</div>
							</div>
						{% endfor %}
					</div>
				</div>
			</div>
		{% else %}
			<div class="card border-0 shadow-sm rounded-4 text-center py-5">
				<div class="card-body py-5">
					<div class="display-1 text-muted opacity-25 mb-4">
						<i class="fas fa-shopping-basket"></i>
					</div>
					<h2 class="h3 fw-bold">Aucune commande trouvée</h2>
					<p class="text-muted mb-4">Vous n'avez pas encore passé de commande sur notre boutique.</p>
					<a href="{{ path('app_product') }}" class="btn btn-primary btn-lg rounded-pill px-5">
						Visiter la cave
					</a>
				</div>
			</div>
		{% endif %}
	</div>
{% endblock %}
