{% extends 'base.html.twig' %}

{% block title %}Suivi de livraison - Commande #{{ order.id }}
{% endblock %}

<div class="py-5">
	<div class="d-flex justify-content-between align-items-center mb-5">
		<div>
			<h1 class="display-4 fw-bold text-primary mb-2">Suivi de livraison</h1>
			<p class="text-muted lead">Commande #{{ order.id }}
				du
				{{ order.dateat|date('d/m/Y') }}</p>
		</div>
		<a href="{{ path('app_order_show', {id: order.id}) }}" class="btn btn-outline-secondary rounded-pill fw-bold">
			<i class="fas fa-arrow-left me-2"></i>Détails commande
		</a>
	</div>

	<div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-5">
		<div
			class="card-body p-4 p-md-5">

			{# Barre de progression du statut (Style Bootstrap) #}
			<div class="position-relative mb-5 py-3">
				<div class="progress" style="height: 4px;">
					<div class="progress-bar bg-primary" role="progressbar" style="width: {% if order.status == 'paid' %}33%{% elseif order.status == 'shipped' %}66%{% elseif order.status == 'delivered' %}100%{% else %}0%{% endif %}"></div>
				</div>

				<div
					class="d-flex justify-content-between position-absolute top-0 w-100 mt-n1">
					{# Étape 1 #}
					<div class="text-center">
						<div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2 shadow" style="width: 32px; height: 32px; margin-top: -14px; position: relative; z-index: 2;">
							<i class="fas fa-check fa-xs"></i>
						</div>
						<div class="small fw-bold">Confirmée</div>
					</div>
					{# Étape 2 #}
					<div class="text-center">
						<div class="{% if order.status in ['paid', 'shipped', 'delivered'] %}bg-primary text-white shadow{% else %}bg-light text-muted border{% endif %} rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 32px; height: 32px; margin-top: -14px; position: relative; z-index: 2;">
							<i class="fas fa-box-open fa-xs"></i>
						</div>
						<div class="small {% if order.status in ['paid', 'shipped', 'delivered'] %}fw-bold{% else %}text-muted{% endif %}">Préparation</div>
					</div>
					{# Étape 3 #}
					<div class="text-center">
						<div class="{% if order.status in ['shipped', 'delivered'] %}bg-primary text-white shadow{% else %}bg-light text-muted border{% endif %} rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 32px; height: 32px; margin-top: -14px; position: relative; z-index: 2;">
							<i class="fas fa-truck fa-xs"></i>
						</div>
						<div class="small {% if order.status in ['shipped', 'delivered'] %}fw-bold{% else %}text-muted{% endif %}">Expédiée</div>
					</div>
					{# Étape 4 #}
					<div class="text-center">
						<div class="{% if order.status == 'delivered' %}bg-primary text-white shadow{% else %}bg-light text-muted border{% endif %} rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 32px; height: 32px; margin-top: -14px; position: relative; z-index: 2;">
							<i class="fas fa-home fa-xs"></i>
						</div>
						<div class="small {% if order.status == 'delivered' %}fw-bold{% else %}text-muted{% endif %}">Livrée</div>
					</div>
				</div>
			</div>

			<div class="row g-4 mt-5">
				<div class="col-md-6">
					<div class="bg-light p-4 rounded-4 h-100 border-start border-4 border-primary">
						<h3 class="h6 fw-bold text-uppercase text-muted mb-4">Expédition</h3>
						<div class="mb-3">
							<span class="d-block small text-muted">Transporteur</span>
							<span class="fw-bold">{{ order.carrier ?? 'En attente...' }}</span>
						</div>
						<div class="mb-0">
							<span class="d-block small text-muted">Numéro de suivi</span>
							<span class="h5 fw-bold text-primary font-monospace">{{ order.trackingNumber ?? 'Indisponible' }}</span>
						</div>
					</div>
				</div>
				<div class="col-md-6">
					<div class="bg-light p-4 rounded-4 h-100 border-start border-4 border-secondary">
						<h3 class="h6 fw-bold text-uppercase text-muted mb-4">Destination</h3>
						<div class="fw-bold fs-5 mb-1">{{ order.user.firstName }}
							{{ order.user.lastName }}</div>
						<div class="text-muted">{{ order.user.address }}</div>
						<div class="text-muted mb-3">{{ order.user.postalCode }}
							{{ order.user.city }}</div>
						<div class="small fw-bold">
							<i class="fas fa-phone me-2 opacity-50"></i>
							{{ order.user.phone }}</div>
					</div>
				</div>
			</div>

			<div class="alert alert-info border-0 shadow-sm rounded-4 d-flex align-items-center gap-3 mt-5 p-4">
				<div class="fs-2">
					<i class="fas fa-info-circle"></i>
				</div>
				<div>
					<h4 class="h6 fw-bold mb-1">Dernière mise à jour</h4>
					<p class="mb-0">
						{% if order.status == 'pending' %}Votre commande est en attente de validation de paiement.
							{% elseif order.status == 'paid' %}Votre commande est en cours de préparation dans nos entrepôts.
							{% elseif order.status == 'shipped' %}Votre colis est en cours de route. Utilisez le numéro de suivi ci-dessus.
							{% elseif order.status == 'delivered' %}Votre colis a été livré. Belle dégustation !
							{% elseif order.status == 'cancelled' %}Cette commande a été annulée.
							{% else %}Statut :
							{{ order.status|upper }}
						{% endif %}
					</p>
				</div>
			</div>
		</div>
	</div>
</div>{% endblock %}
